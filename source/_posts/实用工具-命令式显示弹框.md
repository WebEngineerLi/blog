---
title: 实用工具-命令式显示弹框
date: 2025-05-11 20:19:52
tags: 命令式弹框
---

```typescript jsx
import React from 'react'
import { createRoot, Root } from 'react-dom/client'

interface IProps extends AnyObject {
  onClose?: (params?: any) => void
  onVisibleChange?: boolean
}

/**
 * 将 Modal 变为命令式调用的通用方法
 */
class ModalViewUtils<T extends IProps> {
  private div: HTMLDivElement | null = null
  private Component: any
  private root: Root | undefined = undefined

  constructor(Component: any) {
    this.Component = Component
  }

  close(props: T | undefined, params?: any) {
    if (this.root && this.div) {
      this.root.unmount()
      if (this.div.parentNode) {
        this.div.parentNode.removeChild(this.div)
      }
      props?.onClose?.(params)
    }
  }

  show(props?: T) {
    this.div = document.createElement('div')
    document.body.append(this.div)
    const ModalComponent = this.Component
    const onClose = (params?: any) => {
      this.close(props, params)
    }

    const onOk = (params?: any) => {
      if (props?.onOk) {
        props.onOk(params)
      }
      this.close(props)
    }

    this.root = createRoot(this.div)
    this.root.render(<ModalComponent {...props} onOk={onOk} onClose={onClose} />)
    return onClose
  }
}

export default ModalViewUtils

```
